<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BYBIT Dashboard</title>
  <link rel="stylesheet" href="dashboard.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* ===== Base / Desktop (unchanged layout) ===== */
    :root { --container-max: 1100px; }
    * { box-sizing: border-box; }
    body { background:#0a0c1b; color:#e5e7eb; margin:0; -webkit-font-smoothing:antialiased; }
    .container { max-width:var(--container-max); margin:0 auto; padding:0 24px; }

    /* Header */
    .header .header-container{ display:flex; align-items:center; justify-content:space-between; padding:12px 0; }
    .logo { font-weight:800; letter-spacing:.5px; }
    .header .nav{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
    .header .nav a, .logout-btn{
      color:#e5e7eb; text-decoration:none; background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08); padding:8px 12px; border-radius:999px;
    }
    .logout-btn{ cursor:pointer; }

    /* Profile card */
    .profile { padding:20px 0; background:#0a0c1b; color:#fff; }
    .profile-card{
      display:flex; align-items:center; gap:16px; max-width:900px; margin:auto;
      background:transparent!important; padding:20px; border-radius:12px;
      border:1px solid rgba(255,255,255,.08); box-shadow:0 4px 15px rgba(0,0,0,.4);
    }
    .profile-pic{
      width:90px; height:90px; border-radius:50%; object-fit:cover;
      border:2.5px solid #fff; background:#0b0f1f;
      box-shadow:0 0 8px rgba(255,255,255,.4);
      transition:box-shadow .3s; cursor:pointer; flex:0 0 90px;
    }
    .profile-pic:hover{ box-shadow:0 0 14px rgba(255,255,255,.8); }
    .profile-info{ flex:1; min-width:0; }
    .name-row{ display:flex; align-items:center; gap:8px; }
    .profile-info h2{
      margin:0; font-size:1.2rem; font-weight:800!important; color:#fff; line-height:1.1;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .gold-check{
      width:20px; height:20px; border-radius:999px; display:inline-flex; align-items:center; justify-content:center;
      background:#16c784; border:none; transform:translateY(1px);
    }
    .gold-check svg{ width:14px; height:14px; display:block; }
    .gold-check path{ stroke:#fff; stroke-width:2.5; stroke-linecap:round; stroke-linejoin:round; fill:none; }
    .badge-dark{
      margin-top:6px; background:#16c784; color:#fff; border:none;
      display:inline-flex; align-items:center; gap:6px;
      padding:6px 10px; border-radius:999px; font-size:.72rem; line-height:1;
    }
    .badge-dark path{ stroke:#fff; stroke-width:2.5; stroke-linecap:round; stroke-linejoin:round; fill:none; }
    .profile-info p{ margin:8px 0 0; font-size:1rem; color:#fff; }
    .plan-value, .amount-value{ font-weight:800!important; color:#ffcc00; }

    /* Hero */
    .hero .hero-content { padding:8px 0 6px; }

    /* Crypto banner (centered) */
    .crypto-banner{
      background:transparent!important;
      display:flex; gap:16px;
      justify-content:center; align-items:center;
      flex-wrap:wrap; margin-top:8px;
      max-width:900px; margin-left:auto; margin-right:auto;
      padding:12px 0;
    }
    .crypto-banner img{
      height:40px; width:auto; display:block; background:transparent;
    }

    /* Sections */
    .about, .contact{
      background:rgba(255,255,255,0.04)!important; color:#e5e7eb;
      border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.25);
    }
    .testimonials{ background:#0f1326!important; color:#cfd6e4; }

    /* ===== Mobile (‚â§600px) ‚Äî professional alignment ===== */
    @media (max-width:600px){
      .container{ padding:0 16px; }
      .header .header-container { padding:10px 0; }
      .header .nav{ justify-content:center; gap:10px; }
      .header .nav a, .logout-btn{ min-height:44px; padding:8px 12px; }

      .profile{ padding:16px 0; }
      .profile-card{
        display:grid; grid-template-columns:auto 1fr; gap:12px; padding:16px;
        background:rgba(255,255,255,.03)!important; border:1px solid rgba(255,255,255,.08); border-radius:12px;
        box-shadow:0 6px 20px rgba(0,0,0,.30);
      }
      .profile-pic{ width:78px; height:78px; }
      .name-row{ gap:6px; }
      .profile-info h2{ font-size:1.1rem; }
      .badge-dark{ margin-top:6px; padding:6px 10px; font-size:.72rem; }
      .profile-info p{ margin-top:10px; font-size:.95rem; opacity:.95; }

      .hero .hero-content{ text-align:center; }
      .crypto-banner{ gap:12px; max-width:calc(100% - 32px); }
      .crypto-banner img{ height:34px; }

      .about, .contact, .testimonials .testimonial{
        background: rgba(255,255,255,.03) !important;
        border: 1px solid rgba(255,255,255,.08);
        border-radius:12px; padding:16px;
      }
      .footer{ padding-bottom: calc(16px + env(safe-area-inset-bottom)); }
    }

    /* Force center crypto logos (defensive override) */
    .crypto-banner, .crypto-banner.centered {
      display:flex !important;
      justify-content:center !important;
      align-items:center !important;
      gap:16px; flex-wrap:wrap; overflow-x:visible !important; text-align:center;
    }
    @media (max-width:600px){
      .crypto-banner, .crypto-banner.centered { gap:12px; }
    }

    /* Avatar picker modal (kept, optional to use) */
    #avatarModal{ position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:9999; }
    #avatarModal.open{ display:flex; }
    #avatarModal .sheet{
      width:min(900px,94vw); background:#0b0f1f; border:1px solid rgba(255,255,255,.08);
      border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,.45); color:#e5e7eb;
    }
    .sheet-head{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08); }
    .sheet-head .close{ background:transparent; color:#fff; border:none; font-size:22px; cursor:pointer; line-height:1; }
    .sheet-body{ padding:16px; }
    .avatar-grid{ display:grid; gap:14px; grid-template-columns:repeat(5,88px); justify-content:center; }
    @media (max-width:640px){ .avatar-grid{ grid-template-columns:repeat(4,80px); } }
    .avatar-tile{ width:88px; height:88px; border-radius:50%; overflow:hidden; display:grid; place-items:center; border:2px solid transparent; background:#0b0f1f; cursor:pointer; transition:.12s; }
    .avatar-img{ width:100%; height:100%; object-fit:cover; border-radius:50%; display:block; }
    .avatar-tile:hover{ transform:translateY(-1px); }
    .avatar-tile.selected{ border-color:#16c784; box-shadow:0 0 0 3px rgba(22,199,132,.25); }
    .sheet-foot{ padding:12px 16px; border-top:1px solid rgba(255,255,255,.08); display:flex; gap:10px; justify-content:flex-end; }
    .sheet-foot button{ border:none; padding:10px 14px; border-radius:10px; cursor:pointer; }
    .btn-muted{ background:#1a2035; color:#e5e7eb; }
    .btn-primary{ background:#16c784; color:#0b0f1f; font-weight:700; }
    .btn-primary:disabled{ opacity:.5; cursor:not-allowed; }
  </style>
</head>
<body>

<!-- ===== HEADER ===== -->
<header class="header">
  <div class="container header-container">
    <a href="#hero" class="logo" style="color:white;text-decoration:none;font-weight:bold;">BYBIT</a>
    <nav class="nav">
      <a href="#hero">Home</a>
      <a href="#about">About Us</a>
      <a href="#contact">Contact</a>
      <button id="logoutBtn" class="logout-btn">Logout</button>
    </nav>
  </div>
</header>

<!-- ===== PROFILE ===== -->
<section class="profile" id="profile">
  <div class="container profile-card">
    <div class="profile-pic-container">
      <img src="images/profile.png" alt="Profile Picture" class="profile-pic" id="profilePic" />
    </div>
    <div class="profile-info">
      <div class="name-row">
        <h2 id="fullName">QUEEN PARKER</h2>
        <span class="gold-check" aria-label="Verified">
          <svg viewBox="0 0 20 20" aria-hidden="true"><path d="M5.5 10.2 8.3 13l6.2-6.2"></path></svg>
        </span>
      </div>
      <div class="badge-dark" title="Verified">
        <svg viewBox="0 0 20 20" aria-hidden="true"><path d="M5 10l3 3 7-7"></path></svg>
        Verified
      </div>
      <p id="investmentPlan">Investment Plan: <span class="plan-value">WEB3</span></p>
      <p id="amountInvested">Amount Invested: $<span class="amount-value">0</span></p>
    </div>
  </div>
</section>

<!-- ===== HERO ===== -->
<section class="hero" id="hero">
  <div class="container hero-content">
    <h1>Welcome to Your Dashboard</h1>
    <p>Track your investments, manage your plans, and grow your portfolio.</p>
  </div>
</section>

<!-- ===== CRYPTO BANNER (centered) ===== -->
<div class="crypto-banner" id="crypto">
  <img class="crypto-logo" src="images/bitcoin.png"  alt="BTC" loading="lazy" />
  <img class="crypto-logo" src="images/ethereum.png" alt="ETH" loading="lazy" />
  <img class="crypto-logo" src="images/tether.png"   alt="USDT" loading="lazy" />
  <img class="crypto-logo" src="images/solana.png"   alt="SOL" loading="lazy" />
</div>
<!-- ===== INVESTMENT PLANS SECTION ===== -->
<section class="plans" id="plans">
  <div class="plans-container">

    <!-- WEB3 PUMPS -->
    <div class="plan-card">
      <h3>WEB3 Pumps</h3>
      <ul>
        <li>Ethereum ‚Äì $5,000 ‚Äì $50,000</li>
        <li>TronX ‚Äì $3,000 ‚Äì $15,000</li>
        <li>Shiba ‚Äì $5,000 ‚Äì $15,000</li>
        <li>ADA ‚Äì $5,000 ‚Äì $30,000</li>
        <li>Solana ‚Äì $5,000 ‚Äì $50,000</li>
        <li>Trump ‚Äì $5,000 ‚Äì $25,000</li>
        <li>Doge ‚Äì $4,000 ‚Äì $30,000</li>
        <li>Bitcoin ‚Äì $20,000 ‚Äì 1 Bitcoin</li>
      </ul>
    </div>

    <!-- PARTNERS JOINT ACCOUNT -->
    <div class="plan-card">
      <h3>Partners Joint Account</h3>
      <ul>
        <li><strong>Stage 1:</strong> $50,000 ‚Äì $100,000</li>
        <li><strong>Stage 2:</strong> 2 BTC ‚Äì 5 BTC</li>
      </ul>
    </div>

  </div>
</section>

<!-- ===== CSS ===== -->
<style>
.plans-container {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.plan-card {
  background: #111827;
  padding: 20px;
  border-radius: 10px;
  color: #fff;
  flex: 1 1 300px;
  min-height: 350px; /* Ensures equal height */
  display: flex;
  flex-direction: column;
}

.plan-card h3 {
  color: #ffcc00;
  margin-bottom: 15px;
}

.plan-card ul {
  list-style: none;
  padding: 0;
  margin: 0;
  flex-grow: 1; /* Pushes content evenly */
}

.plan-card li {
  padding: 6px 0;
  border-bottom: 1px solid #2d2d2d;
  font-size: 0.95rem;
}

.plan-card li:last-child {
  border-bottom: none;
}
</style>


<!-- ===== CSS STYLES ===== -->
<style>
.plans {
  margin-top: 2rem;
  padding: 1.5rem;
  border-radius: 12px;
  background: rgba(255,255,255,0.03);
}
.plans h2 {
  text-align: center;
  margin-bottom: 1.5rem;
  font-size: 1.8rem;
  color: #fff;
}
.plans-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.5rem;
}
.plan-card {
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 10px;
  padding: 1rem 1.2rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.plan-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.3);
}
.plan-card h3 {
  color: #ffcc00;
  margin-bottom: .8rem;
}
.crypto-list {
  list-style: none;
  padding: 0;
  margin: 0 0 1rem;
}
.crypto-list li {
  margin-bottom: .5rem;
  font-size: 0.95rem;
  color: #ddd;
}
.crypto-list li strong {
  color: #fff;
}
button.primary, button.secondary {
  padding: 0.6rem 1rem;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}
button.primary {
  background: #ffcc00;
  color: #000;
}
button.primary:hover {
  background: #e6b800;
}
button.secondary {
  background: transparent;
  border: 1px solid #ffcc00;
  color: #ffcc00;
}
button.secondary:hover {
  background: #ffcc00;
  color: #000;
}
</style>

<!-- ===== FOREX TICKER ===== -->
<div class="forex-ticker" id="forex">
  <div class="forex-track">
    <span>EUR/USD üîº Buy @ 1.0880</span>
    <span>GBP/USD üîΩ Sell @ 1.2750</span>
    <span>USD/JPY üîº Buy @ 143.20</span>
    <span>AUD/USD üîΩ Sell @ 0.6680</span>
  </div>
</div>

<!-- ===== ABOUT / CONTACT / TESTIMONIALS ===== -->
<section class="about container" id="about" style="display:none;">
  <h2>About Us</h2>
  <p>At Bybit, our mission is to empower every investor with the best</p>
</section>

<section class="contact container" id="contact" style="display:none;">
  <h2>Contact Us</h2>
  <p>Need help or have questions? Reach out to us anytime.</p>
</section>

<section class="testimonials container" id="testimonials">
  <h2>What Our Investors Say</h2>
  <div class="testimonial">
    <p>‚ÄúBybit helped me grow my crypto portfolio safely!‚Äù</p>
    <strong>‚Äî Ann Coopman</strong>
  </div>
</section>

<!-- ===== FOOTER ===== -->
<footer class="footer">
  <div class="container footer-container">
    <div class="footer-col">
      <h4>Quick Links</h4>
      <ul>
        <li><a href="#hero">Home</a></li>
        <li><a href="#plans">Investment Plans</a></li>
        <li><a href="#about">About Us</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <ul>
        <li><a href="#">How It Works</a></li>
        <li><a href="#">Security & Rent</a></li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom">
    <p>¬© 2025 Bybit Global Ltd. All rights reserved.</p>
    <a href="#">Terms & Conditions</a>
  </div>
</footer>

<!-- ===== AVATAR PICKER MODAL (optional) ===== -->
<div id="avatarModal" role="dialog" aria-modal="true" aria-labelledby="avatarTitle">
  <div class="sheet">
    <div class="sheet-head">
      <h3 id="avatarTitle">Choose your avatar</h3>
      <button class="close" id="avatarCloseBtn" aria-label="Close">√ó</button>
    </div>
    <div class="sheet-body">
      <div id="avatarGrid" class="avatar-grid"></div>
    </div>
    <div class="sheet-foot">
      <button class="btn-muted" id="avatarCancelBtn">Cancel</button>
      <button class="btn-primary" id="avatarSaveBtn" disabled>Save</button>
    </div>
  </div>
</div>

<!-- ===== SCRIPTS ===== -->
<script>
document.addEventListener('DOMContentLoaded', async () => {
  /* ---------- API + auth ---------- */
  let API_URL = (window.APP_CONFIG && window.APP_CONFIG.API_URL) || 'https://bybit-backend-xeuv.onrender.com';
  try { const u = new URL(API_URL); API_URL = u.protocol + '//' + u.host; } catch {}
  const buildApi = (p) => API_URL + (String(p).startsWith('/') ? '' : '/') + p;
  const getToken = () => { try { return (localStorage.getItem('token')||'').trim(); } catch { return ''; } };
  const clearToken = () => { try { localStorage.removeItem('token'); } catch {} };

  async function apiGet(path) {
    const res = await fetch(buildApi(path), {
      method: 'GET', mode: 'cors', cache: 'no-store',
      headers: { Authorization: 'Bearer ' + getToken(), Accept: 'application/json' }
    });
    return res;
  }

  const token = getToken();
  if (!token) { alert('Session expired. Please login again.'); clearToken(); window.location.href='index.html'; return; }

  /* ---------- Load user ---------- */
  try {
    const res = await apiGet('/api/dashboard');
    if (res.status === 401 || res.status === 403) { clearToken(); window.location.href='index.html'; return; }
    if (!res.ok) throw new Error('Failed to fetch user data');
    const user = await res.json();

    const trimTail = (s) => String(s ?? '').replace(/[,\s]+$/,'').trim();
    const toNumber = (v) => { const n = Number(String(v ?? 0).replace(/[^\d.-]/g,'')); return Number.isFinite(n) ? n : 0; };

    const amountRaw = user.amountInvested ?? user.amountinvested ?? user.balance ?? user.amount ?? 0;
    document.getElementById('fullName').textContent = trimTail(user.fullname || user.name || 'QUEEN PARKER');
    document.querySelector('.plan-value').textContent = trimTail(user.investmentPlan || user.package || user.plan || 'WEB3');
    document.querySelector('.amount-value').textContent = toNumber(amountRaw).toLocaleString();

    const picEl = document.getElementById('profilePic');
    const savedLocalPic = (()=>{ try { return localStorage.getItem('profilePic') || ''; } catch { return ''; }})();
    if (picEl) {
      if (user.profilePic) picEl.src = user.profilePic + (user.profilePic.startsWith('data:') ? '' : ('?t=' + Date.now()));
      else if (savedLocalPic) picEl.src = savedLocalPic;
    }
  } catch (err) {
    alert('Session expired or server error. Please login again.');
    clearToken();
    window.location.href = 'index.html';
    return;
  }

  /* ---------- Navigation (show sections without reloading) ---------- */
  function showOnly(sectionId) {
    const ids = ['profile','hero','crypto','forex','about','contact','testimonials'];
    ids.forEach(id => {
      const el = document.getElementById(id); if (!el) return;
      const keepForHero = (sectionId === 'hero' && ['profile','hero','crypto','forex','testimonials'].includes(id));
      el.style.display = (id === sectionId || keepForHero) ? 'block' : 'none';
    });
    if (sectionId) history.replaceState(null,'','#'+sectionId);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  [['#hero','hero'], ['#about','about'], ['#contact','contact']].forEach(([href,id])=>{
    document.querySelectorAll(`a[href="${href}"]`).forEach(a=>{
      a.addEventListener('click',(e)=>{ e.preventDefault(); showOnly(id); });
    });
  });
  document.querySelectorAll('.logo').forEach(el=>{
    el.addEventListener('click',(e)=>{ e.preventDefault(); showOnly('hero'); });
  });
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) logoutBtn.addEventListener('click',(e)=>{
    e.preventDefault(); clearToken(); showOnly('hero'); window.location.href='index.html#hero';
  });
  const initial = (location.hash || '#hero').slice(1);
  showOnly(['hero','about','contact'].includes(initial) ? initial : 'hero');

  /* ================== Avatar Picker (20 hamster variants) ================== */
  function hamsterSVG(theme){
    const { sky1, sky2, sea, wall, ear, fur, snout, nose, glasses, shirt, badge, text, phone, candUp, candDown } = theme;
    const svg = `
<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128">
  <defs>
    <linearGradient id="sky" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="${sky1}"/><stop offset="100%" stop-color="${sky2}"/>
    </linearGradient>
    <clipPath id="round"><circle cx="64" cy="64" r="62"/></clipPath>
  </defs>
  <g clip-path="url(#round)">
    <rect width="128" height="128" fill="url(#sky)"/>
    <rect y="78" width="128" height="50" fill="${sea}" opacity=".45"/>
    <rect x="90" y="40" width="80" height="80" fill="${wall}" transform="rotate(-20 90 40)" opacity=".55"/>
    <circle cx="64" cy="62" r="36" fill="${fur}"/>
    <circle cx="44" cy="40" r="12" fill="${ear}"/><circle cx="84" cy="40" r="12" fill="${ear}"/>
    <circle cx="44" cy="40" r="7" fill="${fur}"/><circle cx="84" cy="40" r="7" fill="${fur}"/>
    <ellipse cx="64" cy="70" rx="16" ry="12" fill="${snout}"/><circle cx="64" cy="66" r="4" fill="${nose}"/>
    <circle cx="51" cy="56" r="11" fill="${glasses}"/><circle cx="77" cy="56" r="11" fill="${glasses}"/>
    <rect x="51" y="55" width="26" height="2.5" fill="${glasses}"/>
    <path d="M36 84c6-10 20-12 28-12s22 2 28 12v22H36V84z" fill="${shirt}"/>
    <text x="75" y="98" font-family="ui-sans-serif,system-ui,Segoe UI,Roboto" font-size="10" text-anchor="middle" fill="${text}" opacity=".9">BYBIT</text>
    <circle cx="87" cy="83" r="7" fill="${badge}"/><path d="M84 83l2 2 4-4" stroke="#0b0f1f" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    <rect x="28" y="78" rx="3" ry="3" width="16" height="26" fill="${phone}"/>
    <line x1="33" y1="84" x2="33" y2="95" stroke="${candUp}" stroke-width="2"/>
    <line x1="38" y1="90" x2="38" y2="100" stroke="${candDown}" stroke-width="2"/>
    <line x1="36" y1="98" x2="36" y2="105" stroke="${candUp}" stroke-width="2"/>
  </g>
</svg>`;
    return "data:image/svg+xml;utf8," + encodeURIComponent(svg);
  }
  const THEMES = [
    { sky1:"#aee3ff", sky2:"#79bfff", sea:"#5ecbe0", wall:"#ffe9b3", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#f39", glasses:"#121212", shirt:"#1e293b", badge:"#16c784", text:"#ffffff", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" },
    { sky1:"#fef3c7", sky2:"#fde68a", sea:"#60a5fa", wall:"#ffd8a8", ear:"#ffd9b8", fur:"#f3d9b1", snout:"#f7e7d6", nose:"#ff6b6b", glasses:"#0f172a", shirt:"#334155", badge:"#facc15", text:"#0b0f1f", phone:"#0b0f1f", candUp:"#22c55e", candDown:"#ef4444" },
    { sky1:"#c7d2fe", sky2:"#818cf8", sea:"#60a5fa", wall:"#fbcfe8", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#fb7185", glasses:"#111827", shirt:"#111827", badge:"#16c784", text:"#facc15", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" },
    { sky1:"#d1fae5", sky2:"#6ee7b7", sea:"#34d399", wall:"#fde68a", ear:"#ffe0c2", fur:"#f3d5b5", snout:"#ffe8d6", nose:"#ff7aa2", glasses:"#0b0f1f", shirt:"#1f2937", badge:"#facc15", text:"#ffffff", phone:"#0b0f1f", candUp:"#22c55e", candDown:"#ef4444" },
    { sky1:"#f5d0fe", sky2:"#e879f9", sea:"#93c5fd", wall:"#fef3c7", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#fb7185", glasses:"#111827", shirt:"#0f172a", badge:"#16c784", text:"#facc15", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" },
    { sky1:"#caffbf", sky2:"#9bf6ff", sea:"#80ed99", wall:"#ffd6a5", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#ff6b6b", glasses:"#0b0f1f", shirt:"#1e293b", badge:"#facc15", text:"#ffffff", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" },
    { sky1:"#bae6fd", sky2:"#60a5fa", sea:"#38bdf8", wall:"#fde68a", ear:"#ffdccc", fur:"#f2cda7", snout:"#f6e1cc", nose:"#ff6b6b", glasses:"#111827", shirt:"#111827", badge:"#16c784", text:"#facc15", phone:"#0b0f1f", candUp:"#22c55e", candDown:"#ef4444" },
    { sky1:"#fecaca", sky2:"#fda4af", sea:"#93c5fd", wall:"#fde68a", ear:"#ffdccc", fur:"#f3d9b1", snout:"#f7e7d6", nose:"#fb7185", glasses:"#0f172a", shirt:"#1f2937", badge:"#facc15", text:"#ffffff", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" },
    { sky1:"#e9d5ff", sky2:"#c4b5fd", sea:"#93c5fd", wall:"#ffd6a5", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#fb7185", glasses:"#0b0f1f", shirt:"#0b0f1f", badge:"#16c784", text:"#facc15", phone:"#0b0f1f", candUp:"#22c55e", candDown:"#ef4444" },
    { sky1:"#ede9fe", sky2:"#ddd6fe", sea:"#93c5fd", wall:"#fef3c7", ear:"#ffdccc", fur:"#f3d5b5", snout:"#ffe8d6", nose:"#ff6b6b", glasses:"#111827", shirt:"#1f2937", badge:"#facc15", text:"#ffffff", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" },
    { sky1:"#bae6fd", sky2:"#7dd3fc", sea:"#38bdf8", wall:"#fde68a", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#fb7185", glasses:"#0b0f1f", shirt:"#2563eb", badge:"#facc15", text:"#ffffff", phone:"#0b0f1f", candUp:"#22c55e", candDown:"#ef4444" },
    { sky1:"#bbf7d0", sky2:"#86efac", sea:"#34d399", wall:"#ffd6a5", ear:"#ffdccc", fur:"#f3d9b1", snout:"#f7e7d6", nose:"#ff7aa2", glasses:"#0f172a", shirt:"#059669", badge:"#facc15", text:"#ffffff", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" },
    { sky1:"#fed7aa", sky2:"#fdba74", sea:"#60a5fa", wall:"#fef3c7", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#fb7185", glasses:"#0f0f0f", shirt:"#f59e0b", badge:"#16c784", text:"#0b0f1f", phone:"#0b0f1f", candUp:"#22c55e", candDown:"#ef4444" },
    { sky1:"#fca5a5", sky2:"#f87171", sea:"#60a5fa", wall:"#ffd6a5", ear:"#ffdccc", fur:"#f3d5b5", snout:"#ffe8d6", nose:"#ff6b6b", glasses:"#111827", shirt:"#ef4444", badge:"#facc15", text:"#0b0f1f", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" },
    { sky1:"#a5b4fc", sky2:"#818cf8", sea:"#93c5fd", wall:"#fde68a", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#fb7185", glasses:"#0b0f1f", shirt:"#8b5cf6", badge:"#facc15", text:"#ffffff", phone:"#0b0f1f", candUp:"#22c55e", candDown:"#ef4444" },
    { sky1:"#f5d0fe", sky2:"#e879f9", sea:"#93c5fd", wall:"#ffd6a5", ear:"#ffdccc", fur:"#f3d9b1", snout:"#f7e7d6", nose:"#ff6b6b", glasses:"#0f172a", shirt:"#d946ef", badge:"#16c784", text:"#0b0f1f", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" },
    { sky1:"#67e8f9", sky2:"#22d3ee", sea:"#38bdf8", wall:"#fde68a", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#fb7185", glasses:"#111827", shirt:"#06b6d4", badge:"#facc15", text:"#0b0f1f", phone:"#0b0f1f", candUp:"#22c55e", candDown:"#ef4444" },
    { sky1:"#fde68a", sky2:"#f59e0b", sea:"#60a5fa", wall:"#ffd6a5", ear:"#ffdccc", fur:"#f3d5b5", snout:"#ffe8d6", nose:"#ff6b6b", glasses:"#0b0f1f", shirt:"#f97316", badge:"#16c784", text:"#0b0f1f", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" },
    { sky1:"#e5e7eb", sky2:"#cbd5e1", sea:"#93c5fd", wall:"#fde68a", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#fb7185", glasses:"#111827", shirt:"#0b0f1f", badge:"#16c784", text:"#facc15", phone:"#0b0f1f", candUp:"#22c55e", candDown:"#ef4444" },
    { sky1:"#0ea5e9", sky2:"#0284c7", sea:"#38bdf8", wall:"#fef3c7", ear:"#ffd9b8", fur:"#f2cda7", snout:"#f6e1cc", nose:"#fb7185", glasses:"#0b0f1f", shirt:"#111827", badge:"#facc15", text:"#ffffff", phone:"#0b0f1f", candUp:"#16c784", candDown:"#ef4444" }
  ];
  const AVATARS = THEMES.map(hamsterSVG);

  const modal = document.getElementById('avatarModal');
  const grid  = document.getElementById('avatarGrid');
  const saveBtn = document.getElementById('avatarSaveBtn');
  const closeBtn = document.getElementById('avatarCloseBtn');
  const cancelBtn = document.getElementById('avatarCancelBtn');
  const picEl = document.getElementById('profilePic');
  let selectedSrc = null;

  function renderAvatars(){
    grid.innerHTML = '';
    AVATARS.forEach((src, i)=>{
      const btn = document.createElement('button');
      btn.type='button'; btn.className='avatar-tile';
      btn.innerHTML = `<img class="avatar-img" src="${src}" alt="Hamster ${i+1}">`;
      btn.addEventListener('click', ()=>{
        [...grid.querySelectorAll('.avatar-tile')].forEach(n=>n.classList.remove('selected'));
        btn.classList.add('selected'); selectedSrc = src; saveBtn.disabled = false;
      });
      grid.appendChild(btn);
    });
  }
  renderAvatars();

  function openAvatarModal(){ saveBtn.disabled = !selectedSrc; modal.classList.add('open'); }
  function closeAvatarModal(){ modal.classList.remove('open'); }

  if (picEl) {
    picEl.addEventListener('click', openAvatarModal);
    const wrap = picEl.closest('.profile-pic-container');
    wrap && wrap.addEventListener('click', (e)=>{ if (e.target === wrap) openAvatarModal(); });
  }
  closeBtn.addEventListener('click', closeAvatarModal);
  cancelBtn.addEventListener('click', closeAvatarModal);
  modal.addEventListener('click', (e)=>{ if (e.target === modal) closeAvatarModal(); });

  async function saveSelectedAvatar(){
    if (!selectedSrc) return;
    if (picEl) picEl.src = selectedSrc;
    try{
      const res = await fetch(buildApi('/api/profile/picture'), {
        method:'POST',
        headers:{ 'Content-Type':'application/json', 'Authorization':'Bearer '+(getToken?getToken():'') },
        body: JSON.stringify({ image: selectedSrc, isDataUrl: true })
      });
      if (!res.ok) throw new Error('save failed');
      try{ localStorage.removeItem('profilePic'); }catch{}
    }catch(err){
      try{ localStorage.setItem('profilePic', selectedSrc); }catch{}
    }
    closeAvatarModal();
  }
  saveBtn.addEventListener('click', saveSelectedAvatar);
});
</script>

</body>
</html>
